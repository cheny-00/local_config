# Fail2ban filter for SeaweedFS S3 direct logs
# Matches S3 authentication failures and errors

[INCLUDES]
before = common.conf

[Definition]

# SeaweedFS S3 日志格式示例：
# 2024/12/01 12:00:00 s3 SignatureDoesNotMatch from 1.2.3.4
# 2024/12/01 12:00:00 s3 AccessDenied from 1.2.3.4
# 2024/12/01 12:00:00 ERROR s3api [1.2.3.4] InvalidAccessKeyId

# 签名不匹配（密钥错误）
failregex = ^.*SignatureDoesNotMatch.*from <ADDR>.*$
            ^.*InvalidAccessKeyId.*from <ADDR>.*$
            ^.*AccessDenied.*from <ADDR>.*$
            ^.*InvalidAccessKeyId.*\[<ADDR>\].*$
            ^.*SignatureDoesNotMatch.*\[<ADDR>\].*$

# S3 认证错误的通用模式
            ^.*s3.*(?:authentication failed|invalid credentials|access denied).*<ADDR>.*$
            ^.*ERROR.*s3.*\[<ADDR>\].*(?:Invalid|Access|Signature).*$

ignoreregex =
